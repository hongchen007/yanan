<?php/** * Created by PhpStorm. * User: Administrator * Date: 2019/8/21 * Time: 11:28 */namespace app\admin\model;class Code extends BaseModel{    /**     * 添加邮箱验证码     * @param $code     * @param $info     * @return bool     */    public function addcode($code,$info)    {        $date['email']       = $info;        $date['email_code']  = $code;        $date['create_time'] = date('Y-m-d H:i:s');        $date['update_time'] = date('Y-m-d H:i:s');        try {            $this->save($date);            return true;        } catch (\Exception $exception){            $exception->getMessage();            return false;        }    }    /**     * 验证验证码的正确性     * @param $date     * @return bool|int     * @throws \think\db\exception\DataNotFoundException     * @throws \think\db\exception\ModelNotFoundException     * @throws \think\exception\DbException     */    public function checkcode($date)    {        //查找指定邮箱的最新一条数据 判断时间在五分钟之内的是否有数据 => 判断数据是否正确        $where['email']  = $date['user_email'];        $bbb = time()-300;        $codeinfo = $this            ->order('id','desc')            ->whereTime('create_time','>=',$bbb)            ->where($where)            ->find();        if(empty($codeinfo)){            return 31; //验证码不存在货已经过期，请重新发送        }        if($codeinfo['email_code'] !== $date['vercode']){            return 32; //验证码不正确        }        return true;    }}