<?php/** * Created by PhpStorm. * User: Administrator * Date: 2019/7/26 * Time: 15:12 */namespace app\admin\model;class LoveHistory extends BaseModel{    //列表页    public function index($data, $limit)    {        $info = $this            ->where($data)            ->order('history_year','desc')            ->paginate($limit)	        ->each(function($item){		        $item['history_year'] = date('Y-m-d',strtotime($item['history_year']));	        });        return $info;    }    //添加    public function add_img($arr)    {        //数据处理        $arr['create_time'] = date('Y-m-d H:i:s', time());        $arr['update_time'] = date('Y-m-d H:i:s', time());        $info = $this->allowField(true)->save($arr);        if ($info) {            return true; //添加成功        } else {            return false; //添加失败        }    }    //删除    public function img_del($date)    {        $info = $this->where('id', $date)->find();        $del  = $this->where('id', $date)->delete();        if ($del) {            @unlink($_SERVER["DOCUMENT_ROOT"] . $info['history_pic']);            return true; //删除成功        } else {            return false;//删除失败        }    }    //修改信息    public function updateinfo($date)    {        $arr = $this->find($date);        $arr['history_year'] = date('Y-m-d',strtotime($arr['history_year']));        return $arr;    }    /**     * 执行修改     * @param $date     */    public function updateedit($date)    {        $date['update_time'] = date('Y-m-d H:i:s', time());        if (empty($date['history_pic'])) {            //没有修改图片            unset($date['history_pic']);            $info = $this->allowField(true)->isUpdate(true)->update($date);            if ($info) {                return true; //修改成功            } else {                return false; //修改失败            }        } else {            //修改图片,修改成功删除图片            $picinfo = $this->where('id', $date['id'])->find();            $info = $this->allowField(true)->isUpdate(true)->update($date);            if ($info) {                @unlink($_SERVER["DOCUMENT_ROOT"] . $picinfo['history_pic']);                return true; //修改成功            } else {                return false; //修改失败            }        }    }}