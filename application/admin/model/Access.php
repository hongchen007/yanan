<?php/** * Created by PhpStorm. * User: Administrator * Date: 2019/7/31 * Time: 9:59 */namespace app\admin\model;use think\Db;class Access extends BaseModel{    /**     * 列表     * @return mixed     */    public function index($limit)    {        $info = $this->paginate($limit);        $info = $this->gettree($info);        return $info;    }    /**     * 查找所有权限     * @return array     */    public function findall()    {        $info = $this->select()->toArray();        $info = $this->gettree($info);        return $info;    }    /**     * 树状     * @param $date     * @param int $access_parent_id     * @param int $deep     * @return array     */    public function gettree(&$date,$access_parent_id = 0,$deep = 1)    {        $info = array();        foreach($date as $k=>$v){            if($v['access_parent_id'] == $access_parent_id){                $v['deep'] = $deep;                $v['access_name1'] = $this->prename($deep).$v['access_name'];                $info[] = $v;                $info = array_merge($info,self::gettree($date,$v['id'],$deep+1));            }        }        return $info;    }    /**     * 加前缀     * @param $deep     * @return string     */    public function prename($deep)    {        $pre = '';        if($deep > 1){            for($i = 1; $i < $deep ;$i++){                $pre .= '--| ';            }        }        return $pre;    }    /**     * 添加     * @param $arr     * @return int     */    public function add_img($arr)    {        //数据处理        $arr['create_time'] = date('Y-m-d H:i:s', time());        $arr['update_time'] = date('Y-m-d H:i:s', time());        $info = $this->allowField(true)->save($arr);        if ($info) {            return 1; //添加成功        } else {            return 11; //添加失败        }    }    //删除    public function img_del($date)    {        $info  = $this->where('id', $date)->delete();        if ($info) {            return 1; //删除成功        } else {            return 2;//删除失败        }    }    /**     * 根据单个id查找权限信息     * @param $date     * @return array|\PDOStatement|string|\think\Model|null     * @throws \think\db\exception\DataNotFoundException     * @throws \think\db\exception\ModelNotFoundException     * @throws \think\exception\DbException     */    public function updateinfo($date)    {        $info = $this->where('id',$date)->find();        return $info;    }    /**     * 修改权限     * @param $date     * @return int     */    public function updateedit($date)    {        $date['create_time'] = strtotime('Y-m-d H:i:s',time());        $info = $this->allowField(true)->isUpdate(true)->update($date);        if($info){            return 1;        }else{            return 11;        }    }    /**     * 根据id集合查询所有符合条件的数据     * @param $date     * @return mixed     */    public function findcondition($date)    {        $info = $this->field('access_url')->all(implode(',', $date))->toArray();        $info = array_column($info,'access_url');//        $info = $this->gettree($info);        return $info;    }}